Sub ExtractMsgHTMLBodyToTextFile()
    Dim outlookApp As Outlook.Application
    Dim msg As Outlook.MailItem
    Dim fd As Office.FileDialog
    Dim selectedFile As String
    Dim fso As Object
    Dim textFile As Object
    Dim htmlBody As String
    Dim textFilePath As String
    
    ' 初始化 Outlook 应用
    Set outlookApp = New Outlook.Application
    
    ' 创建文件对话框以选择 .msg 文件
    Set fd = outlookApp.FileDialog(msoFileDialogFilePicker)
    
    With fd
        .Title = "请选择一个 Outlook 邮件文件"
        .Filters.Clear
        .Filters.Add "Outlook 文件", "*.msg"
        If .Show = -1 Then ' 如果选中了文件
            selectedFile = .SelectedItems(1) ' 获取文件路径
        Else
            MsgBox "未选择文件"
            Exit Sub
        End If
    End With
    
    ' 打开选中的 .msg 文件
    Set msg = outlookApp.Session.OpenSharedItem(selectedFile)
    
    ' 获取邮件的 HTML 正文
    htmlBody = msg.HTMLBody
    
    ' 设置要写入的文本文件路径
    textFilePath = "C:\Path\To\Your\Directory\emailBody.txt" ' 请修改为实际路径
    
    ' 创建 FileSystemObject 以写入文件
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set textFile = fso.CreateTextFile(textFilePath, True)
    
    ' 将 HTML 正文写入文件
    textFile.Write htmlBody
    textFile.Close
    
    MsgBox "HTML 正文已成功写入: " & textFilePath
    
    ' 清理
    Set fso = Nothing
    Set textFile = Nothing
    Set msg = Nothing
    Set outlookApp = Nothing
End Sub
